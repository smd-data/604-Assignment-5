---
title: "603 Final Project"
output: 
  flexdashboard::flex_dashboard:
    vertical_layout: scroll
editor: visual
---

```{r, include=FALSE}
library(haven)
library(tidyverse)
library(dplyr)
library(dagitty)
library(skimr)
library(modelsummary)
library(kableExtra)
library(stargazer)
library(jtools)
library(ggplot2)
library(ggeffects)
library(plotly)
library(flexdashboard)
```

```{r, include=FALSE}
afs_full <- read_dta("~/School/Intro to Quantitative Analysis/afs2021.dta")
head(afs_full)

afs <- afs_full[c("s21_MSC013", "birthyr", "s21_DEM015", "gender", "race",
                  "ideo5", "faminc_new", "Pick5to18Child_age",
                  "s21_FAMTAX003_rule", "s21_PID001", "s21_COV023_4_1",
                  "s21_MSC014_c")]

afs <- afs |>
  rename("number_children" = "s21_MSC013", 
         "childcare_hours" = "s21_DEM015",
         "percent_care_self" = "s21_COV023_4_1",
         "PID" = "s21_PID001",
         "child_benefit" = "s21_FAMTAX003_rule",
         "child_age" = "Pick5to18Child_age",
         "number_household" = "s21_MSC014_c")

afs <- afs |>
  mutate(
    gender = case_when(
      gender == 1 ~ "male",
      gender == 2 ~ "female"),
    PID = case_when(
      PID == 1 ~ "Republican",
      PID == 2 ~ "Democrat",
      PID == 3 ~ "Independent",
      PID == 4 ~ "Other"
      ),
    ideo5 = case_when(
      ideo5 == 1 | ideo5 == 2 ~ "Liberal",
      ideo5 == 3 ~ "Moderate",
      ideo5 == 4 | ideo5 == 5 ~ "Conservative",
      ideo5 == 6 ~ "Not Sure"
    ),
    faminc_new = case_when(
      faminc_new >= 1 & faminc_new <= 4  ~ "less than $40,000",
      faminc_new >= 5 & faminc_new <= 8  ~ "$40,000 to $79,999",
      faminc_new >= 9 & faminc_new <= 12  ~ "$80,000 to $199,999",
      faminc_new >= 13 & faminc_new <= 16  ~ "$200,000 or more",
      faminc_new == 97 ~ NA
    ),
    race = case_when(
      race == 1 ~ "White",
      race == 2 ~ "Black",
      race == 3 ~ "Hispanic",
      race == 4 ~ "Asian",
      race == 5 ~ "Native American",
      race == 6 ~ "Two or more races",
      race == 7 ~ "Other",
      race == 8 ~ "Middle Eastern"
    ),
    child_age = case_when(
      child_age == "5-year-old" ~ 5,
      child_age == "6-year-old" ~ 6,
      child_age == "7-year-old" ~ 7,
      child_age == "8-year-old" ~ 8,
      child_age == "9-year-old" ~ 9,
      child_age == "10-year-old" ~ 10,
      child_age == "11-year-old" ~ 11,
      child_age == "12-year-old" ~ 12,
      child_age == "13-year-old" ~ 13,
      child_age == "14-year-old" ~ 14,
      child_age == "15-year-old" ~ 15,
      child_age == "16-year-old" ~ 16,
      child_age == "17-year-old" ~ 17,
      child_age == "18-year-old" ~ 18,
      child_age == "" ~ NA
    )
    )

#column for tax benefit amount in dollars
afs$child_benefit_dollars <- afs$child_benefit * 100

#convert 99 to 0 for number of children
afs$number_children[afs$number_children == 99] <- 0
```


```{r, include=FALSE}
# Summary of Data
afs_2 <- afs |>
  select(child_benefit_dollars, childcare_hours, child_age,
            number_children, faminc_new)
```




```{r, include=FALSE}
# Original Regression Model
mod <- lm(child_benefit_dollars ~ childcare_hours + child_age +
            number_children + faminc_new, data = afs_2)
summary(mod)
```


```{r, include=FALSE}
## Coefficient Table
mod_labels <- c("Childcare Hours",
                "Child Age",
                "Number of Children",
                "Family Income: $40,000 to $79,999",
                "Family Income: $80,000 to $199,999",
                "Family Income: Less than $40,000")

mod_table <- stargazer(mod, type = "text", single.row = T,
             report = "vcs*p*",
             covariate.labels = mod_labels,
             dep.var.labels = "Suggested Child Tax Benefit")
```


```{r, include=FALSE}
mod_labels2 <- c("Intercept:" =  "(Intercept)",
                 "Childcare Hours" = "childcare_hours",
                 "Child Age" = "child_age",
                 "Number of Children" = "number_children",
                 "Family Income: $40,000 to $79,999" = 
                   "faminc_new$40,000 to $79,999",
                 "Family Income: $80,000 to $199,999" = 
                   "faminc_new$80,000 to $199,999",
                 "Family Income: Less than $40,000" = 
                   "faminc_newless than $40,000")

#export_summs(mod, coefs = mod_labels2,
#             model.names = c("Suggested Child Tax Benefit"),
#             to.file = "docx",
#             file.name = "604 Assignment 3 results table original.docx")
```


```{r, include=FALSE}
mod_pred <- ggpredict(mod, terms = c("childcare_hours"))
```


```{r, include=FALSE}
plot1 <- ggplot(mod_pred, aes(x = x, y = predicted)) + geom_line() +
  labs(title="Predicted Suggested Child Tax Credit with \n95% Confidence Intervals",
       x = "Number of Hours Caring for Children",
       y = "Suggested Child Tax Credit (Dollars)") +
  xlim(0, 24) + ylim(2750, 4250) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.05, 
              linetype = "dashed") +
  theme_minimal()

plot1
```


```{r, include=FALSE}
plot2 <- ggplot(mod_pred, aes(x = x, y = predicted)) + geom_smooth(method = "lm") +
  labs(title="Predicted Suggested Child Tax Credit with 
       95% Confidence Intervals",
       x = "Number of Hours Caring for Children",
       y = "Suggested Child Tax Credit (Dollars)") +
  xlim(0, 24) + ylim(2750, 4250) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), alpha = 0.05, 
              linetype = "dashed") +
  theme_minimal()

plot2
```



Plot
=======================================================================

Row
-----------------------------------------------------------------------

### Plot 1

```{r}
ggplotly(plot1)
```


Row
-----------------------------------------------------------------------

### Text 1

This plot depicts the predicted outcomes for the suggested Child Tax Credit amount based on the number of hours a parent spends caring for their children on their own during a typical day. For every one-hour increase in time a parent spends caring for their children on their own during a typical day, their suggested Child Tax Credit decreases by around $1.08. This effect is not significant (p=0.922). These results do not support the hypothesis that people who spend more time caring for their children on their own are more likely to support a higher Child Tax Credit.



